<div class="min-h-screen bg-base-200">
  <%= render "shared/navbar" %>

  <div class="container mx-auto p-4 max-w-4xl">
    <div class="breadcrumbs text-sm mb-4">
      <ul>
        <li><%= link_to "ダッシュボード", dashboard_path %></li>
        <li><%= link_to "運転記録", driving_records_path %></li>
        <li>詳細</li>
      </ul>
    </div>

    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <div class="flex justify-between items-center mb-6">
          <h2 class="card-title text-2xl">運転記録 詳細</h2>
          <div class="flex gap-2">
            <%= link_to "編集", edit_driving_record_path(@driving_record), class: "btn btn-warning btn-sm" %>
            <%= button_to "削除", driving_record_path(@driving_record), method: :delete,
                data: { turbo_confirm: "本当に削除しますか？" },
                class: "btn btn-error btn-sm" %>
          </div>
        </div>

        <!-- 出発情報 -->
        <div class="divider">出発情報</div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-500">出発日時</p>
            <p class="font-semibold"><%= @driving_record.departure_datetime.strftime("%Y年%m月%d日 %H:%M") %></p>
          </div>

          <div>
            <p class="text-sm text-gray-500">店舗名</p>
            <p class="font-semibold"><%= @driving_record.store.name %></p>
          </div>

          <div class="md:col-span-2">
            <p class="text-sm text-gray-500">出発地点</p>
            <p class="font-semibold"><%= @driving_record.departure_location || @driving_record.store.address || "未設定" %></p>
            <% if @driving_record.departure_latitude && @driving_record.departure_longitude %>
              <p class="text-xs text-gray-400 mt-1">
                📍 <%= @driving_record.departure_latitude.round(6) %>, <%= @driving_record.departure_longitude.round(6) %>
                <%= link_to "地図で見る", "https://www.google.com/maps?q=#{@driving_record.departure_latitude},#{@driving_record.departure_longitude}",
                    target: "_blank", class: "link link-primary ml-2" %>
              </p>
            <% end %>
          </div>
        </div>

        <!-- 経由地 -->
        <% if @driving_record.waypoint_location.present? %>
          <div class="divider">経由地</div>

          <div>
            <p class="text-sm text-gray-500">経由地</p>
            <p class="font-semibold"><%= @driving_record.waypoint_location %></p>
            <% if @driving_record.waypoint_latitude && @driving_record.waypoint_longitude %>
              <p class="text-xs text-gray-400 mt-1">
                📍 <%= @driving_record.waypoint_latitude.round(6) %>, <%= @driving_record.waypoint_longitude.round(6) %>
                <%= link_to "地図で見る", "https://www.google.com/maps?q=#{@driving_record.waypoint_latitude},#{@driving_record.waypoint_longitude}",
                    target: "_blank", class: "link link-primary ml-2" %>
              </p>
            <% end %>
          </div>
        <% end %>

        <!-- 到着情報 -->
        <div class="divider">到着情報</div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-500">到着日時</p>
            <p class="font-semibold"><%= @driving_record.arrival_datetime.strftime("%Y年%m月%d日 %H:%M") %></p>
          </div>

          <div>
            <p class="text-sm text-gray-500">顧客</p>
            <p class="font-semibold"><%= @driving_record.customer&.name || "未登録" %></p>
          </div>

          <div class="md:col-span-2">
            <p class="text-sm text-gray-500">目的地</p>
            <p class="font-semibold"><%= @driving_record.destination %></p>
            <% if @driving_record.destination_latitude && @driving_record.destination_longitude %>
              <p class="text-xs text-gray-400 mt-1">
                📍 <%= @driving_record.destination_latitude.round(6) %>, <%= @driving_record.destination_longitude.round(6) %>
                <%= link_to "地図で見る", "https://www.google.com/maps?q=#{@driving_record.destination_latitude},#{@driving_record.destination_longitude}",
                    target: "_blank", class: "link link-primary ml-2" %>
              </p>
            <% end %>
          </div>
        </div>

        <!-- 運転情報 -->
        <div class="divider">運転情報</div>

        <div class="stats stats-vertical lg:stats-horizontal shadow w-full">
          <div class="stat">
            <div class="stat-title">走行距離</div>
            <div class="stat-value text-primary"><%= @driving_record.distance %>km</div>
          </div>

          <div class="stat">
            <div class="stat-title">金額</div>
            <div class="stat-value text-secondary">¥<%= number_with_delimiter(@driving_record.amount) %></div>
          </div>

          <div class="stat">
            <div class="stat-title">車両</div>
            <div class="stat-value text-lg"><%= @driving_record.vehicle.vehicle_number %></div>
            <div class="stat-desc"><%= @driving_record.vehicle.vehicle_info %></div>
          </div>

          <div class="stat">
            <div class="stat-title">ドライバー</div>
            <div class="stat-value text-lg"><%= @driving_record.driver.name %></div>
          </div>
        </div>

        <!-- 備考 -->
        <% if @driving_record.notes.present? %>
          <div class="divider">備考</div>

          <div class="bg-base-200 p-4 rounded-lg">
            <p class="whitespace-pre-wrap"><%= @driving_record.notes %></p>
          </div>
        <% end %>

        <!-- アクション -->
        <div class="card-actions justify-end mt-6">
          <%= link_to "一覧に戻る", driving_records_path, class: "btn btn-ghost" %>
        </div>
      </div>
    </div>
  </div>
</div>
